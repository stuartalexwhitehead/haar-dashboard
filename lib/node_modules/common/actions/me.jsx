import axios from 'axios';

import * as requestActions from 'common/actions/request';

export function requestCurrentUser() {
  return {
    type: 'REQUEST_CURRENT_USER',
  };
}

export function receiveCurrentUser(json) {
  return {
    type: 'RECEIVE_CURRENT_USER',
    user: json,
  };
}

export function fetchCurrentUser() {
  return function fetchCurrentUserThunk(dispatch, getState) {
    const { auth } = getState();
    dispatch(requestCurrentUser);
    dispatch(requestActions.startRequest);

    return axios({
      method: 'get',
      baseURL: process.env.API__URL,
      url: '/users/me',
      headers: {
        'x-access-token': auth.token,
      },
    })
    .then(response => {
      dispatch(receiveCurrentUser(response.data.data));
      dispatch(requestActions.endRequest);
    }).catch(() => {
      dispatch(requestActions.endRequest);
    });
  };
}
