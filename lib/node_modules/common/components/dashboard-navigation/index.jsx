import React from 'react';
import { connect } from 'react-redux';
import classnames from 'classnames';

import DLink from 'common/components/d-link';
import Logo from 'common/components/logo';
import * as navActions from 'common/actions/navigation';

class DashboardNavigation extends React.Component {
  static propTypes = {
    navigation: React.PropTypes.object,
    me: React.PropTypes.object,
    dispatch: React.PropTypes.func,
  };

  toggleNav = () => {
    this.props.dispatch(navActions.toggleNavigation());
  }

  render() {
    const { me, navigation } = this.props;

    const dashboard = (
      <DLink
        to="/dashboard"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--dashboard"
      >
        Dashboard
      </DLink>
    );
    const profile = (
      <DLink
        to="/dashboard/me"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--profile"
      >
        Profile
      </DLink>
    );
    const users = (
      <DLink
        to="/dashboard/users"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--users"
      >
        Users
      </DLink>
    );
    const deviceTypes = (
      <DLink
        to="/dashboard/device-types"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--device-types"
      >
        Devices Types
      </DLink>
    );
    const devices = (
      <DLink
        to="/dashboard/devices"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--devices"
      >
        Devices
      </DLink>
    );
    const logout = (
      <a
        href="/logout"
        onClick={this.toggleNav}
        className="dashboard-nav__link icon--logout"
      >
        Logout
      </a>
    );

    const userLinks = [dashboard, profile, devices, logout];
    const adminLinks = [dashboard, profile, users, deviceTypes, devices, logout];
    const authedLinks = me.role === 'admin' ? adminLinks : userLinks;

    const navClasses = classnames(
      'dashboard-nav',
      {
        'dashboard-nav--open': navigation.isOpen,
      }
    );

    const navToggleClasses = classnames(
      'dashboard-nav__toggle',
      {
        'icon--menu': !navigation.isOpen,
        'icon--close': navigation.isOpen,
      }
    );

    return (
      <div>
        <div className={navToggleClasses} onClick={this.toggleNav} />
        <nav className={navClasses}>
          <Logo className="dashboard-nav__logo" />

          <ul className="dashboard-nav__items">
            { authedLinks.map((link, i) => (
              <li key={i} className="dashboard-nav__item">{link}</li>
            )) }
          </ul>
        </nav>
      </div>
    );
  }
}

const mapStateToProps = (state) => ({
  me: state.me,
  navigation: state.navigation,
});

export default connect(mapStateToProps)(DashboardNavigation);
